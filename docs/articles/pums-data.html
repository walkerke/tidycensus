<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with Census microdata • tidycensus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with Census microdata">
<meta property="og:description" content="tidycensus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidycensus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic-usage.html">Basic usage of tidycensus</a>
    </li>
    <li>
      <a href="../articles/spatial-data.html">Spatial data in tidycensus</a>
    </li>
    <li>
      <a href="../articles/margins-of-error.html">Margins of error in the ACS</a>
    </li>
    <li>
      <a href="../articles/other-datasets.html">Other Census Bureau datasets</a>
    </li>
    <li>
      <a href="../articles/pums-data.html">Working with Census microdata</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/walkerke/tidycensus">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pums-data_files/header-attrs-2.5.3/header-attrs.js"></script><script src="pums-data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="pums-data_files/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet">
<script src="pums-data_files/anchor-sections-1.0.1/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with Census microdata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/walkerke/tidycensus/blob/master/vignettes/pums-data.Rmd"><code>vignettes/pums-data.Rmd</code></a></small>
      <div class="hidden name"><code>pums-data.Rmd</code></div>

    </div>

    
    
<p>Most of the data available through tidycensus and the Census API is aggregated to certain geographic levels (tract, county, state, etc.). In other words, the data we get by executing <code><a href="../reference/get_acs.html">get_acs()</a></code> has been summarized by the Census Bureau so that we are able to learn how many people live in a particular county or what the median household income of a state is. There are thousands of individual variables that the Census aggregates and publishes in tabular form.</p>
<p>For many purposes, these pre-aggregated tables have enough information to work with. But, the Census Bureau also releases <strong>microdata</strong> from the American Community Survey. Microdata is the individual-level responses to the ACS that is used to create the summary and detail tables the Census publishes. Instead of a getting one row per state from a table, we can get one row per respondent. For the American Community Survey, this data is called the <a href="https://www.census.gov/programs-surveys/acs/technical-documentation/pums/about.html"><strong>Public Use Microdata Sample</strong> (PUMS)</a>.</p>
<p>Using PUMS data instead of the published tables can be a very powerful tool. It can, for instance, allow you to create custom estimates that aren’t available in pre-aggregated tables. You can also use microdata to fit models on individual-level data instead of modeling block groups or census tracts.</p>
<p>Until recently, PUMS data was only available from the <a href="https://www2.census.gov/programs-surveys/acs/data/pums/2018/1-Year/">Census Bureau FTP site</a> and was somewhat cumbersome to use. Now, PUMS data is available via web API, which means you can easily access it in R by using tidycensus.</p>
<div id="pumas" class="section level2">
<h2 class="hasAnchor">
<a href="#pumas" class="anchor"></a>PUMAs</h2>
<p>One trade-off with using PUMS data as compared to aggregated data is that you only get the state and <a href="https://www.census.gov/programs-surveys/geography/guidance/geo-areas/pumas.html">public use microdata area (PUMA)</a> of each individual in the microdata. PUMAs are Census geographies that contain at least 100,000 people and are entirely within a single state. They are built from census tracts and counties and may or may not be similar to other recognized geographic boundaries. In New York City, for instance, PUMAs are closely aligned to <a href="https://www1.nyc.gov/assets/planning/download/pdf/data-maps/nyc-population/census2010/puma_cd_map.pdf">Community Districts</a>. So, if you are interested in pulling data about block groups, census tracts, or other small areas, you can’t use PUMS data.</p>
</div>
<div id="pums-data-dictionaries" class="section level2">
<h2 class="hasAnchor">
<a href="#pums-data-dictionaries" class="anchor"></a>PUMS data dictionaries</h2>
<p>The first place to start is to identify the variables you want to download. There are hundreds of PUMS variables and each describes characteristics of a person or a housing unit. <code>pums_variables</code> is a dataset built into tidycensus that contains names, descriptions, codes, and other metadata about the PUMS variables.</p>
<p>Because PUMS variables and codes can change slightly by year, you should select which year’s data you will be working with and filter <code>pums_variables</code> for only that year and survey. In the following example, we will be working with the 2018 1-year American Community Survey.</p>
<p>Later in this vignette, we use the <a href="http://r-survey.r-forge.r-project.org/survey/"><strong>survey</strong></a> and <a href="http://gdfe.co/srvyr/"><strong>srvyr</strong></a> to calculate PUMS estimates, so if you want to follow along and you don’t already have them installed, you should install these two packages from CRAN.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"survey"</span>, <span class="st">"srvyr"</span>))</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidycensus</span>)

<span class="no">pums_vars_2018</span> <span class="kw">&lt;-</span> <span class="no">pums_variables</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">year</span> <span class="kw">==</span> <span class="fl">2018</span>, <span class="no">survey</span> <span class="kw">==</span> <span class="st">"acs1"</span>)</pre></body></html></div>
<p><code>pums_variables</code> contains both the variables as well as their possible values. So let’s just look at the unique variables.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">pums_vars_2018</span> <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">var_code</span>, <span class="no">var_label</span>, <span class="no">data_type</span>, <span class="no">level</span>)</pre></body></html></div>
<pre><code>## # A tibble: 513 x 4
##   var_code var_label                                                                      data_type level
##   &lt;chr&gt;    &lt;chr&gt;                                                                          &lt;chr&gt;     &lt;chr&gt;
## 1 RT       Record Type                                                                    chr       &lt;NA&gt; 
## 2 SERIALNO Housing unit/GQ person serial number                                           chr       &lt;NA&gt; 
## 3 DIVISION Division code based on 2010 Census definitions                                 chr       &lt;NA&gt; 
## 4 PUMA     Public use microdata area code (PUMA) based on 2010 Census definition (areas … chr       &lt;NA&gt; 
## 5 REGION   Region code based on 2010 Census definitions                                   chr       &lt;NA&gt; 
## # … with 508 more rows</code></pre>
<p>If you’re new to PUMS data, this is a good dataset to browse to get a feel for what variables are available.</p>
</div>
<div id="person-vs--housing-unit" class="section level2">
<h2 class="hasAnchor">
<a href="#person-vs--housing-unit" class="anchor"></a>Person vs. housing unit</h2>
<p>Some PUMS variables relate to individuals (e.g. age, race, educational attainment) while others relate to households/housing units (e.g. number of bedrooms, electricity cost, property value).</p>
<p>Individuals in PUMS data are always nested within a housing unit (The ACS is sent to an housing unit address and all people living in that unit complete the survey.) Housing units are uniquely identified by the <code>SERIALNO</code> variable and persons are uniquely identified by the combination of <code>SERIALNO</code> and <code>SPORDER</code>. In the data dictionary included in tidycensus, variables are identified as either “housing” or “person” variables in the level column. Here, for example, are the first five person-level variables in the data dictionary.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">pums_vars_2018</span> <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">var_code</span>, <span class="no">var_label</span>, <span class="no">data_type</span>, <span class="no">level</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">level</span> <span class="kw">==</span> <span class="st">"person"</span>)</pre></body></html></div>
<pre><code>## # A tibble: 279 x 4
##   var_code var_label                       data_type level 
##   &lt;chr&gt;    &lt;chr&gt;                           &lt;chr&gt;     &lt;chr&gt; 
## 1 SPORDER  Person number                   num       person
## 2 PWGTP    Person's weight                 num       person
## 3 AGEP     Age                             num       person
## 4 CIT      Citizenship status              chr       person
## 5 CITWP    Year of naturalization write-in num       person
## # … with 274 more rows</code></pre>
<p>It is important to be mindful of whether the variables you choose to analyze are person- or household-level variables.</p>
</div>
<div id="using-get_pums-to-download-pums-data" class="section level2">
<h2 class="hasAnchor">
<a href="#using-get_pums-to-download-pums-data" class="anchor"></a>Using <code>get_pums()</code> to download PUMS data</h2>
<p>To download PUMS data from the Census API, use the <code><a href="../reference/get_pums.html">get_pums()</a></code> function. If you’ve used other <code>get_*()</code> functions in tidycensus, it should be familiar to you. The key arguments to specify are <code>variables</code>, <code>state</code>, <code>survey</code>, and <code>year</code>. Here we get <code>PUMA</code>, <code>SEX</code>, <code>AGEP</code>, and <code>SCHL</code> variables for Vermont from the 2018 1-year ACS.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">vt_pums</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PUMA"</span>, <span class="st">"SEX"</span>, <span class="st">"AGEP"</span>, <span class="st">"SCHL"</span>),
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"VT"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>
  )</pre></body></html></div>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">vt_pums</span></pre></body></html></div>
<pre><code>## # A tibble: 6,436 x 9
##   SERIALNO      SPORDER  WGTP PWGTP  AGEP PUMA  ST    SCHL  SEX  
##   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 2018GQ0001230       1     0     3    26 00300 50    20    1    
## 2 2018GQ0002135       1     0    64    18 00100 50    19    2    
## 3 2018GQ0002999       1     0    62    20 00400 50    19    2    
## 4 2018GQ0004077       1     0    16    94 00200 50    21    2    
## 5 2018GQ0006486       1     0    26    20 00400 50    19    1    
## # … with 6,431 more rows</code></pre>
<p>We get 6436 rows and 9 columns. In addition to the variables we specified, <code><a href="../reference/get_pums.html">get_pums()</a></code> also always returns <code>SERIALNO</code>, <code>SPORDER</code>, <code>WGTP</code>, <code>PWGTP</code>, and <code>ST</code>. <code>SERIALNO</code> and <code>SPORDER</code> are the variables that uniquely identify observations, <code>WGTP</code> and <code>PWGTP</code> are the housing-unit and person weights, and <code>ST</code> is the state code.</p>
<p>Notice that <code>ST</code>, <code>SEX</code> and <code>SCHL</code> return coded character variables. You can look up what these codes represent in the <code>pums_variables</code> dataset provided or set <code>recode = TRUE</code> in <code><a href="../reference/get_pums.html">get_pums()</a></code> to return additional columns with the values of these variables recoded.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">vt_pums_recoded</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PUMA"</span>, <span class="st">"SEX"</span>, <span class="st">"AGEP"</span>, <span class="st">"SCHL"</span>),
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"VT"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>,
  <span class="kw">recode</span> <span class="kw">=</span> <span class="fl">TRUE</span>
  )</pre></body></html></div>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">vt_pums_recoded</span></pre></body></html></div>
<pre><code>## # A tibble: 6,436 x 12
##   SERIALNO   SPORDER  WGTP PWGTP  AGEP PUMA  ST    SCHL  SEX   ST_label  SCHL_label             SEX_label
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;ord&gt;     &lt;ord&gt;                  &lt;ord&gt;    
## 1 2018GQ000…       1     0     3    26 00300 50    20    1     Vermont/… Associate's degree     Male     
## 2 2018GQ000…       1     0    64    18 00100 50    19    2     Vermont/… 1 or more years of co… Female   
## 3 2018GQ000…       1     0    62    20 00400 50    19    2     Vermont/… 1 or more years of co… Female   
## 4 2018GQ000…       1     0    16    94 00200 50    21    2     Vermont/… Bachelor's degree      Female   
## 5 2018GQ000…       1     0    26    20 00400 50    19    1     Vermont/… 1 or more years of co… Male     
## # … with 6,431 more rows</code></pre>
</div>
<div id="analyzing-pums-data" class="section level2">
<h2 class="hasAnchor">
<a href="#analyzing-pums-data" class="anchor"></a>Analyzing PUMS data</h2>
<p>Remember that PUMS data is a sample of about 1% of the US population. When we want to estimate a variable that represents the entire population rather than a sample, we have to apply a weighting adjustment. A simple way to think about PUMS weights is that for each observation in the sample, the weight variable tells us the number of people in the population that the observation represents. So, if we simply add up all the person weights in our VT PUMS data, we get the (estimated) population of Vermont.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">vt_pums_recoded</span>$<span class="no">PWGTP</span>)</pre></body></html></div>
<pre><code>## [1] 626299</code></pre>
<p>Another convenient approach to weighting PUMS data is to use the <code>wt</code> argument in <code><a href="https://dplyr.tidyverse.org/reference/count.html">dplyr::count()</a></code>. Here, we calculate the population by sex for each PUMA in Vermont (there are only four in the whole state!).</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">vt_pums_recoded</span> <span class="kw">%&gt;%</span>
  <span class="fu">count</span>(<span class="no">PUMA</span>, <span class="no">SEX_label</span>, <span class="kw">wt</span> <span class="kw">=</span> <span class="no">PWGTP</span>)</pre></body></html></div>
<pre><code>## # A tibble: 8 x 3
##   PUMA  SEX_label      n
##   &lt;chr&gt; &lt;ord&gt;      &lt;dbl&gt;
## 1 00100 Male      108732
## 2 00100 Female    111564
## 3 00200 Male       73768
## 4 00200 Female     73416
## 5 00300 Male       61601
## 6 00300 Female     64806
## 7 00400 Male       65675
## 8 00400 Female     66737</code></pre>
<p>Many of the variables included in the PUMS data are categorical and we might want to group some categories together and estimate the proportion of the population with these characteristics. In this example, we first create a new variable that is whether or not the person has a Bachelor’s degree or above, group by PUMA and sex, then calculate the total population, average age, total with BA or above (only for people 25 and older), and percent with BA or above.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">vt_pums_recoded</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">ba_above</span> <span class="kw">=</span> <span class="no">SCHL</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"21"</span>, <span class="st">"22"</span>, <span class="st">"23"</span>, <span class="st">"24"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">PUMA</span>, <span class="no">SEX_label</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(
    <span class="kw">total_pop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PWGTP</span>),
    <span class="kw">mean_age</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html">weighted.mean</a></span>(<span class="no">AGEP</span>, <span class="no">PWGTP</span>),
    <span class="kw">ba_above</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PWGTP</span>[<span class="no">ba_above</span> <span class="kw">==</span> <span class="fl">TRUE</span> <span class="kw">&amp;</span> <span class="no">AGEP</span> <span class="kw">&gt;=</span> <span class="fl">25</span>]),
    <span class="kw">ba_above_pct</span> <span class="kw">=</span> <span class="no">ba_above</span> / <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PWGTP</span>[<span class="no">AGEP</span> <span class="kw">&gt;=</span> <span class="fl">25</span>])
  )</pre></body></html></div>
<pre><code>## # A tibble: 8 x 6
## # Groups:   PUMA [4]
##   PUMA  SEX_label total_pop mean_age ba_above ba_above_pct
##   &lt;chr&gt; &lt;ord&gt;         &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
## 1 00100 Male         108732     38.2    34113        0.469
## 2 00100 Female       111564     40.4    36873        0.473
## 3 00200 Male          73768     41.4    15831        0.303
## 4 00200 Female        73416     43.6    20248        0.367
## 5 00300 Male          61601     43.7    14869        0.326
## 6 00300 Female        64806     45.0    21527        0.434
## 7 00400 Male          65675     41.9    12788        0.278
## 8 00400 Female        66737     44.6    18980        0.391</code></pre>
</div>
<div id="calculating-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-standard-errors" class="anchor"></a>Calculating standard errors</h2>
<p>In the previous examples, you might have noticed that we calculate a point estimate, but do not get a standard error or margin of error as is included in aggregated Census tables. It is important to calculate standard errors when making custom estimates using PUMS data, because it can be easy to create a very small sub-group where there are not enough observations in the sample to make a reliable estimate.</p>
<p>The standard package for calculating estimates and fitting models with complex survey objects is the <a href="http://r-survey.r-forge.r-project.org/survey/"><strong>survey</strong> package</a>. The <a href="http://gdfe.co/srvyr/index.html"><strong>srvyr</strong> package</a> is an alternative and wraps some survey functions to allow for analyzing surveys using <strong>dplyr</strong>-style syntax. tidycensus provides a function, <code><a href="../reference/to_survey.html">to_survey()</a></code>, that converts data frames returned by <code><a href="../reference/get_pums.html">get_pums()</a></code> into either a survey or srvyr object.</p>
<p>In order to generate reliable standard errors, the Census Bureau provides a set of <a href="https://usa.ipums.org/usa/repwt.shtml">replicate weights</a> for each observation in the PUMS dataset. These replicate weights are used to simulate multiple samples from the single PUMS sample and can be used to calculate more precise standard errors. PUMS data contains both person- and housing-unit-level replicate weights.</p>
<p>To download replicate weights along with PUMS data, set the <code>rep_weights</code> argument in <code><a href="../reference/get_pums.html">get_pums()</a></code> to <code>"person"</code>, <code>"housing"</code>, or <code>"both"</code>. Here we get the same Vermont PUMS data as above in addition to the 80 person replicate weight columns.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">vt_pums_rep_weights</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PUMA"</span>, <span class="st">"SEX"</span>, <span class="st">"AGEP"</span>, <span class="st">"SCHL"</span>),
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"VT"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>,
  <span class="kw">recode</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">rep_weights</span> <span class="kw">=</span> <span class="st">"person"</span>
  )</pre></body></html></div>
<p>To easily convert this data frame to a survey or srvyr object, we can use the <code><a href="../reference/to_survey.html">to_survey()</a></code> function.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">vt_survey_design</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/to_survey.html">to_survey</a></span>(<span class="no">vt_pums_rep_weights</span>)</pre></body></html></div>
<p>By default, <code><a href="../reference/to_survey.html">to_survey()</a></code> converts a data frame to a <code>tbl_svy</code> object by using person replicate weights. You can change the arguments in <code>to_survey</code> if you are analyzing housing-unit data (<code>type = "housing"</code>), if you prefer to use a cluster/strata survey design without replicate weights (<code>design = "cluster"</code>), or if you want a survey object instead of a srvyr object. (Although, <code>tbl_svy</code> objects also have a svyrep.design class so you can <a href="http://gdfe.co/srvyr/articles/srvyr-vs-survey.html#using-survey-functions-on-srvyr-objects">use survey functions on srvyr objects</a>.)</p>
<p>Now, with our srvyr design object defined, we can calculate the same estimates as above, but we now get column with standard errors as well.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">srvyr</span>, <span class="kw">warn.conflicts</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">vt_survey_design</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_tally.html">survey_count</a></span>(<span class="no">PUMA</span>, <span class="no">SEX_label</span>)</pre></body></html></div>
<pre><code>## # A tibble: 8 x 4
##   PUMA  SEX_label      n  n_se
##   &lt;chr&gt; &lt;ord&gt;      &lt;dbl&gt; &lt;dbl&gt;
## 1 00100 Male      108732 1123.
## 2 00100 Female    111564 1360.
## 3 00200 Male       73768  754.
## 4 00200 Female     73416  809.
## 5 00300 Male       61601  491.
## 6 00300 Female     64806  578.
## 7 00400 Male       65675  702.
## 8 00400 Female     66737  776.</code></pre>
<p>The srvyr syntax is very similar to standard dplyr syntax, so this should look familiar; we’ve swapped out <code>count()</code> for <code><a href="https://rdrr.io/pkg/srvyr/man/survey_tally.html">survey_count()</a></code> and we don’t need a <code>wt</code> argument because we defined the weights when we set up the srvyr object.</p>
<p>The equivalent estimate using survey syntax looks like this:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="kw pkg">survey</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyby.html">svyby</a></span>(~<span class="no">SEX_label</span>, ~<span class="no">PUMA</span>, <span class="kw">design</span> <span class="kw">=</span> <span class="no">vt_survey_design</span>, <span class="kw pkg">survey</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/survey/man/surveysummary.html">svytotal</a></span>)</pre></body></html></div>
<pre><code>##        PUMA SEX_labelMale SEX_labelFemale       se1       se2
## 00100 00100        108732          111564 1122.9765 1360.3476
## 00200 00200         73768           73416  754.0906  808.7364
## 00300 00300         61601           64806  490.5432  578.3529
## 00400 00400         65675           66737  702.0659  775.9812</code></pre>
<p>We can also repeat the estimate we did above and calculate the percentage of people that are 25 and up with a bachelor’s degree, while this time returning the upper and lower bounds of the confidence interval for these estimates. This time though, we have to subset our data frame to only those 25 and older before we summarize.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">vt_survey_design</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">mutate</a></span>(<span class="kw">ba_above</span> <span class="kw">=</span> <span class="no">SCHL</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"21"</span>, <span class="st">"22"</span>, <span class="st">"23"</span>, <span class="st">"24"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">filter</a></span>(<span class="no">AGEP</span> <span class="kw">&gt;=</span> <span class="fl">25</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/group_by.html">group_by</a></span>(<span class="no">PUMA</span>, <span class="no">SEX_label</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/summarise.html">summarize</a></span>(
    <span class="kw">age_25_up</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_total.html">survey_total</a></span>(<span class="kw">vartype</span> <span class="kw">=</span> <span class="st">"ci"</span>),
    <span class="kw">ba_above</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_total.html">survey_total</a></span>(<span class="no">ba_above</span>, <span class="kw">vartype</span> <span class="kw">=</span> <span class="st">"ci"</span>),
    <span class="kw">ba_pct</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_mean.html">survey_mean</a></span>(<span class="no">ba_above</span>, <span class="kw">vartype</span> <span class="kw">=</span> <span class="st">"ci"</span>)
    )</pre></body></html></div>
<pre><code>## # A tibble: 8 x 11
## # Groups:   PUMA [4]
##   PUMA  SEX_label age_25_up age_25_up_low age_25_up_upp ba_above ba_above_low ba_above_upp ba_pct
##   &lt;chr&gt; &lt;ord&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;  &lt;dbl&gt;
## 1 00100 Male          72680        70216.        75144.    34113       29913.       38313.  0.469
## 2 00100 Female        77966        75671.        80261.    36873       32202.       41544.  0.473
## 3 00200 Male          52278        50826.        53730.    15831       13327.       18335.  0.303
## 4 00200 Female        55162        53643.        56681.    20248       17679.       22817.  0.367
## 5 00300 Male          45634        44743.        46525.    14869       12638.       17100.  0.326
## 6 00300 Female        49546        48576.        50516.    21527       19010.       24044.  0.434
## 7 00400 Male          45960        45067.        46853.    12788       10699.       14877.  0.278
## 8 00400 Female        48601        47783.        49419.    18980       16540.       21420.  0.391
## # … with 2 more variables: ba_pct_low &lt;dbl&gt;, ba_pct_upp &lt;dbl&gt;</code></pre>
</div>
<div id="modeling-with-pums-data" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling-with-pums-data" class="anchor"></a>Modeling with PUMS data</h2>
<p>An important use case for PUMS data is doing regression analysis or other modeling. Let’s try to predict the length of an individual’s commute to work (<code>JWMNP</code>) based on their wages, employer type (private, public, self), and which PUMA they live in. We’ll use the 2018 5-year estimates so we have a bigger sample to work with.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">vt_pums_to_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PUMA"</span>, <span class="st">"WAGP"</span>, <span class="st">"JWMNP"</span>, <span class="st">"JWTR"</span>, <span class="st">"COW"</span>, <span class="st">"ESR"</span>),
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"VT"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs5"</span>
  )</pre></body></html></div>
<p>Now, we filter out observations that aren’t relevant, do a little recoding of the class of worker variable, and finally convert the data frame to a survey design object. Note that we did not request replicate weights from the API, so we specify <code>design = "cluster"</code> when we create the survey design. This creates the survey using a cluster design with the household (<code>SERIALNO</code>) as the primary sampling unit, the PUMA as the strata, and <code>PWGTP</code> as the weight.</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">vt_model_sd</span> <span class="kw">&lt;-</span> <span class="no">vt_pums_to_model</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">filter</a></span>(
    <span class="no">ESR</span> <span class="kw">==</span> <span class="fl">1</span>,   <span class="co"># civilian employed</span>
    <span class="no">JWTR</span> <span class="kw">!=</span> <span class="fl">11</span>, <span class="co"># does not work at home</span>
    <span class="no">WAGP</span> <span class="kw">&gt;</span> <span class="fl">0</span>,   <span class="co"># earned wages last year</span>
    <span class="no">JWMNP</span> <span class="kw">&gt;</span> <span class="fl">0</span>   <span class="co"># commute more than zero min</span>
    ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">mutate</a></span>(
    <span class="kw">emp_type</span> <span class="kw">=</span> <span class="fu">case_when</span>(
      <span class="no">COW</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span>, <span class="st">"2"</span>)      ~ <span class="st">"private"</span>,
      <span class="no">COW</span> <span class="kw">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>) ~ <span class="st">"public"</span>,
      <span class="fl">TRUE</span>                      ~ <span class="st">"self"</span>
      )
    ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/to_survey.html">to_survey</a></span>(<span class="kw">design</span> <span class="kw">=</span> <span class="st">"cluster"</span>)</pre></body></html></div>
<p>Let’s quickly check out some summary stats using <code>srvyr</code>.</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">vt_model_sd</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/summarise.html">summarize</a></span>(
    <span class="kw">n</span>              <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_total.html">survey_total</a></span>(<span class="fl">1</span>),
    <span class="kw">mean_wage</span>      <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_mean.html">survey_mean</a></span>(<span class="no">WAGP</span>),
    <span class="kw">median_wage</span>    <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_quantile.html">survey_median</a></span>(<span class="no">WAGP</span>),
    <span class="kw">mean_commute</span>   <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_mean.html">survey_mean</a></span>(<span class="no">JWMNP</span>),
    <span class="kw">median_commute</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_quantile.html">survey_median</a></span>(<span class="no">JWMNP</span>)
    )</pre></body></html></div>
<pre><code>## # A tibble: 1 x 10
##        n  n_se mean_wage mean_wage_se median_wage median_wage_se mean_commute mean_commute_se
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;
## 1 282733 3395.    44601.         527.       35000           255.         23.3           0.256
## # … with 2 more variables: median_commute &lt;dbl&gt;, median_commute_se &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">vt_model_sd</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_tally.html">survey_count</a></span>(<span class="no">emp_type</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 3
##   emp_type      n  n_se
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 private  224760 3128.
## 2 public    42966 1356.
## 3 self      15007  763.</code></pre>
<p>And now we’re ready to fit a simple linear regression model.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">model</span> <span class="kw">&lt;-</span> <span class="kw pkg">survey</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svyglm.html">svyglm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">JWMNP</span>) ~ <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="no">WAGP</span>) + <span class="no">emp_type</span> + <span class="no">PUMA</span>, <span class="kw">design</span> <span class="kw">=</span> <span class="no">vt_model_sd</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">model</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## svyglm(formula = log(JWMNP) ~ log(WAGP) + emp_type + PUMA, design = vt_model_sd)
## 
## Survey design:
## Called via srvyr
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     1.699601   0.093094  18.257  &lt; 2e-16 ***
## log(WAGP)       0.113913   0.008817  12.920  &lt; 2e-16 ***
## emp_typepublic -0.052845   0.025339  -2.086   0.0371 *  
## emp_typeself   -0.306227   0.045270  -6.764 1.42e-11 ***
## PUMA00200       0.007800   0.028076   0.278   0.7812    
## PUMA00300       0.023629   0.028526   0.828   0.4075    
## PUMA00400      -0.117300   0.027733  -4.230 2.36e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 0.6817393)
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
<div id="mapping-pums-data" class="section level2">
<h2 class="hasAnchor">
<a href="#mapping-pums-data" class="anchor"></a>Mapping PUMS data</h2>
<p>If you’ve used the spatial functionality in tidycensus before, you might also want to put your custom PUMS estimates on a map. To do this, let’s use <code>tigris</code> to download PUMA boundaries for the states in New England as an <code>sf</code> object.</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">ne_states</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"VT"</span>, <span class="st">"NH"</span>, <span class="st">"ME"</span>, <span class="st">"MA"</span>, <span class="st">"CT"</span>, <span class="st">"RI"</span>)
<span class="no">ne_pumas</span> <span class="kw">&lt;-</span> <span class="fu">map</span>(<span class="no">ne_states</span>, <span class="kw pkg">tigris</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/tigris/man/pumas.html">pumas</a></span>, <span class="kw">class</span> <span class="kw">=</span> <span class="st">"sf"</span>, <span class="kw">cb</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">reduce</span>(<span class="no">rbind</span>)</pre></body></html></div>
<p>Next we download the income-to-poverty ratio from the PUMS dataset and calculate the percentage of population below 200% of the poverty line for each PUMA.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">ne_pums</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PUMA"</span>, <span class="st">"POVPIP"</span>),
  <span class="kw">state</span> <span class="kw">=</span> <span class="no">ne_states</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>
  )

<span class="no">ne_pov</span> <span class="kw">&lt;-</span> <span class="no">ne_pums</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/group_by.html">group_by</a></span>(<span class="no">ST</span>, <span class="no">PUMA</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/summarise.html">summarize</a></span>(
    <span class="kw">total_pop</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PWGTP</span>),
    <span class="kw">pct_in_pov</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">PWGTP</span>[<span class="no">POVPIP</span> <span class="kw">&lt;</span> <span class="fl">200</span>]) / <span class="no">total_pop</span>
  )</pre></body></html></div>
<p>And now we can make a choropleth map by joining the PUMA boundaries with the PUMS data.</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">ne_pumas</span> <span class="kw">%&gt;%</span>
  <span class="fu">left_join</span>(<span class="no">ne_pov</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"STATEFP10"</span> <span class="kw">=</span> <span class="st">"ST"</span>, <span class="st">"PUMACE10"</span> <span class="kw">=</span> <span class="st">"PUMA"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">pct_in_pov</span>)) +
  <span class="fu">geom_sf</span>() +
  <span class="fu">scale_fill_viridis_b</span>(
    <span class="kw">name</span> <span class="kw">=</span> <span class="kw">NULL</span>,
    <span class="kw">option</span> <span class="kw">=</span> <span class="st">"magma"</span>,
    <span class="kw">labels</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_percent.html">label_percent</a></span>(<span class="fl">1</span>)
    ) +
  <span class="fu">labs</span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">"Percentage of population below 200% of the poverty line"</span>) +
  <span class="fu">theme_void</span>()</pre></body></html></div>
<p><img src="pums-data_files/figure-html/unnamed-chunk-23-1.png" width="768"></p>
</div>
<div id="verification-of-pums-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#verification-of-pums-estimates" class="anchor"></a>Verification of PUMS estimates</h2>
<p>The Census provides <a href="https://www.census.gov/programs-surveys/acs/technical-documentation/pums/documentation.2018.html">calculated estimates and standard errors</a> for a number of states and variables to ensure that users’ analysis of PUMS data matches the expected values.</p>
<p>In the following example, we generate a few estimates using the methodology described above. You may want to perform a similar verification on your system to ensure your PUMS estimates will be accurate.</p>
<p>Here are a few estimates we’ll verify from the 2018 ACS 1-year PUMS estimates for user verification file:</p>
<table class="table">
<thead><tr class="header">
<th>State</th>
<th>Variable</th>
<th>Estimate</th>
<th>SE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Wyoming</td>
<td>GQ institutional population (RELP=16)</td>
<td>7018</td>
<td>3</td>
</tr>
<tr class="even">
<td>Utah</td>
<td>Owned free and clear (TEN=2)</td>
<td>209632</td>
<td>3972</td>
</tr>
<tr class="odd">
<td>Hawaii</td>
<td>Age 0-4</td>
<td>86452</td>
<td>944</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">wy_relp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="st">"RELP"</span>,
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"Wyoming"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>,
  <span class="kw">rep_weights</span> <span class="kw">=</span> <span class="st">"person"</span>
)

<span class="no">ut_ten</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="st">"TEN"</span>,
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"Utah"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>,
  <span class="kw">rep_weights</span> <span class="kw">=</span> <span class="st">"housing"</span>
)

<span class="no">hi_age</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/get_pums.html">get_pums</a></span>(
  <span class="kw">variables</span> <span class="kw">=</span> <span class="st">"AGEP"</span>,
  <span class="kw">state</span> <span class="kw">=</span> <span class="st">"Hawaii"</span>,
  <span class="kw">survey</span> <span class="kw">=</span> <span class="st">"acs1"</span>,
  <span class="kw">rep_weights</span> <span class="kw">=</span> <span class="st">"person"</span>
)</pre></body></html></div>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">wy_relp</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/to_survey.html">to_survey</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_tally.html">survey_count</a></span>(<span class="no">RELP</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">filter</a></span>(<span class="no">RELP</span> <span class="kw">==</span> <span class="st">"16"</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1 x 3
##   RELP      n  n_se
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 16     7018  2.64</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">ut_ten</span> <span class="kw">%&gt;%</span>
  <span class="fu">distinct</span>(<span class="no">SERIALNO</span>, <span class="kw">.keep_all</span> <span class="kw">=</span> <span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/to_survey.html">to_survey</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">"housing"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_tally.html">survey_count</a></span>(<span class="no">TEN</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">filter</a></span>(<span class="no">TEN</span> <span class="kw">==</span> <span class="fl">2</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1 x 3
##   TEN        n  n_se
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 2     209632 3972.</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">hi_age</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/dplyr_single.html">filter</a></span>(<span class="fu">between</span>(<span class="no">AGEP</span>, <span class="fl">0</span>, <span class="fl">4</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/to_survey.html">to_survey</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/summarise.html">summarize</a></span>(<span class="kw">age_0_4</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/srvyr/man/survey_total.html">survey_total</a></span>(<span class="fl">1</span>))</pre></body></html></div>
<pre><code>## # A tibble: 1 x 2
##   age_0_4 age_0_4_se
##     &lt;dbl&gt;      &lt;dbl&gt;
## 1   86452       944.</code></pre>
<p>3 for 3 – yay!</p>
</div>
<div id="more-resources-for-analyzing-pums-data" class="section level2">
<h2 class="hasAnchor">
<a href="#more-resources-for-analyzing-pums-data" class="anchor"></a>More resources for analyzing PUMS data</h2>
<ul>
<li><a href="http://gdfe.co/srvyr/"><strong>srvyr</strong> website</a></li>
<li><a href="http://r-survey.r-forge.r-project.org/survey/"><strong>survey</strong> website</a></li>
<li><a href="https://www.census.gov/programs-surveys/acs/technical-documentation/pums.html">Census Bureau PUMS documention</a></li>
<li><a href="https://usa.ipums.org/usa-action/faq">IPUMS FAQs</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kyle Walker, Matt Herman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
